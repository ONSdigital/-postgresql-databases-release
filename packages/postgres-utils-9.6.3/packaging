#!/bin/bash -ex

pwd

echo "Extracting archive..."
tar -zxf postgres/postgresql-*

cd postgresql-*

if [[ "$(uname -a)" =~ "x86_64" || "$(uname -a)" =~ "ppc64le" ]] ; then
	./configure --prefix="$BOSH_INSTALL_TARGET" --with-openssl
else
	CFLAGS=-m32 LDFLAGS=-m32 CXXFLAGS=-m32 ./configure --prefix="$BOSH_INSTALL_TARGET"  --with-openssl
fi

for i in psql pg_dump; do
	make -C src/bin/$i $i

	make -C src/bin/$i install
done

make -C src/interfaces/libpq install
